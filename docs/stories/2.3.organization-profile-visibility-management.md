# Story 2.3: Organization Profile Visibility Management

## Status
Draft

## Story
**As a** user who belongs to multiple organizations,  
**I want** to control what profile information is visible in each organization with granular field-level controls,  
**so that** I can share appropriate professional details for different contexts while maintaining privacy and professional boundaries.

## Acceptance Criteria

1. **Individual Field Visibility Controls**
   - User can toggle visibility (show/hide) for each profile field per organization
   - Visibility controls are available for: name, photo, title, skills, interests, experience, projects, personal info, contact details
   - Changes are saved automatically and applied immediately
   - Clear visual indication of hidden vs. visible fields

2. **Bulk Visibility Management**
   - User can select multiple profile fields and apply visibility changes to multiple organizations at once
   - "Apply to all organizations" option for consistent visibility across all memberships
   - "Copy from [Organization Name]" option to replicate visibility settings
   - Bulk operations include confirmation step to prevent accidental changes

3. **Profile Preview Mode**
   - User can preview their profile as it appears to members of each organization
   - Preview mode clearly indicates "This is how [Organization Name] members see your profile"
   - Preview includes all visible fields with actual data rendering
   - Easy toggle between "Edit mode" and "Preview mode"

4. **Visibility Templates**
   - Pre-defined templates: "Corporate" (formal fields only), "Community" (interests/skills focus), "Project Team" (experience/skills focus), "Full Profile" (everything visible)
   - User can create custom templates and name them
   - One-click application of templates to organizations
   - Template application shows preview before confirming changes

5. **Smart Visibility Suggestions**
   - System suggests appropriate visibility settings based on organization type (if available)
   - Warning when critical fields (name, photo) are hidden in professional organizations
   - Notification when profile appears "incomplete" due to too many hidden fields
   - Suggestions respect user's privacy choices and are easily dismissible

## Tasks / Subtasks

- [ ] Create field-level visibility control interface (AC: 1)
  - [ ] Design toggle switches for each profile field per organization
  - [ ] Implement real-time preview of visibility changes
  - [ ] Add visual indicators for hidden/visible field states
  - [ ] Create responsive design for mobile visibility management

- [ ] Build bulk management functionality (AC: 2)
  - [ ] Create multi-select interface for profile fields
  - [ ] Implement "Apply to multiple orgs" modal with organization selection
  - [ ] Add "Copy visibility from" dropdown with organization list
  - [ ] Create confirmation dialogs for bulk operations

- [ ] Implement profile preview system (AC: 3)
  - [ ] Create preview mode that renders profile as organization members see it
  - [ ] Add organization context selector for preview
  - [ ] Implement edit/preview mode toggle
  - [ ] Ensure preview matches actual profile display logic

- [ ] Develop visibility templates system (AC: 4)
  - [ ] Create predefined template definitions and logic
  - [ ] Build custom template creation and naming interface
  - [ ] Implement template application with preview confirmation
  - [ ] Add template management (edit, delete, rename)

- [ ] Add smart suggestions and warnings (AC: 5)
  - [ ] Implement organization type detection for suggestions
  - [ ] Create warning system for incomplete profiles
  - [ ] Build dismissible notification system
  - [ ] Add privacy-respecting suggestion algorithms

## Dev Notes

**Relevant Architecture Context:**
- Profile data structure already supports field-level metadata for visibility settings
- Organization membership model includes organization type classification
- Profile rendering system can be extended to respect visibility rules
- User interface framework supports modal dialogs and toggle components

**Key Data Model Requirements:**
- User profile fields need per-organization visibility flags: `{fieldName: {orgId: boolean}}`
- Template storage: `{templateId, userId, name, visibilitySettings: {fieldName: boolean}}`
- Organization type classifications for smart suggestions
- Visibility change audit trail for user accountability

**API Endpoints Needed:**
- GET /api/user/{userId}/visibility/{orgId}
- PUT /api/user/{userId}/visibility/{orgId}
- POST /api/user/{userId}/visibility/bulk-update
- GET /api/user/{userId}/visibility/templates
- POST /api/user/{userId}/visibility/templates
- GET /api/user/{userId}/profile/preview/{orgId}

**Performance Considerations:**
- Cache visibility settings for quick profile rendering
- Lazy load visibility controls only when editing
- Optimize bulk operations to minimize database writes
- Efficient template application across multiple organizations

**Integration Points:**
- Profile editing interface needs organization context selector
- Profile display components must check visibility rules before rendering
- Organization switching must trigger visibility rule updates
- Mobile profile editing requires touch-optimized visibility controls

**Security Requirements:**
- Visibility changes only affect current user's profile
- No ability to modify other users' visibility settings
- Audit logging for significant visibility changes
- Validate organization membership before applying visibility rules

### Testing
**Testing Standards:**
- Unit tests for visibility rule application logic
- Integration tests for bulk operations and template management
- E2E tests for complete visibility management workflow
- Performance tests for users with many organizations and fields
- Accessibility tests for visibility control interfaces
- Cross-browser testing for toggle and modal interactions

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-04 | 1.0 | Initial story creation | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_